<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!doctype html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="ja"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1">&lt;meta charset="utf-8"&gt;</span></p>
<p class="p1"><span class="s1">&lt;title&gt;ITパスポート 過去問トレーナー（2025r07）&lt;/title&gt;</span></p>
<p class="p1"><span class="s1">&lt;meta name="viewport" content="width=device-width,initial-scale=1"&gt;</span></p>
<p class="p1"><span class="s1">&lt;style&gt;</span></p>
<p class="p1"><span class="s1">:root{</span></p>
<p class="p1"><span class="s1">--bg:#0f1115; --panel:#151924; --accent:#4cc9f0; --ok:#4caf50; --ng:#ef5350; --muted:#99a2b2; --text:#e6eaf2;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">*{box-sizing:border-box}</span></p>
<p class="p1"><span class="s1">body{margin:0;background:linear-gradient(180deg,#0f1115,#0d1220);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}</span></p>
<p class="p1"><span class="s1">a{color:var(--accent)}</span></p>
<p class="p1"><span class="s1">.wrap{max-width:980px;margin:0 auto;padding:24px}</span></p>
<p class="p1"><span class="s1">.card{background:var(--panel);border:1px solid #1f2533;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}</span></p>
<p class="p1"><span class="s1">.pad{padding:20px}</span></p>
<p class="p1"><span class="s1">h1{font-size:22px;margin:0 0 12px}</span></p>
<p class="p1"><span class="s1">h2{font-size:18px;margin:0 0 10px}</span></p>
<p class="p1"><span class="s1">.row{display:flex;gap:14px;flex-wrap:wrap}</span></p>
<p class="p1"><span class="s1">.col{flex:1 1 240px}</span></p>
<p class="p1"><span class="s1">.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:12px 16px;border:1px solid #283044;border-radius:12px;background:#1a2130;color:var(--text);cursor:pointer;font-weight:600}</span></p>
<p class="p1"><span class="s1">.btn:hover{border-color:#34405a}</span></p>
<p class="p1"><span class="s1">.btn[disabled]{opacity:.5;cursor:not-allowed}</span></p>
<p class="p1"><span class="s1">.btn-primary{background:linear-gradient(180deg,#1c2a46,#15233c);border-color:#2d3a55}</span></p>
<p class="p1"><span class="s1">.btn-accent{background:linear-gradient(180deg,#13364a,#0f2e42);border-color:#1f546c;color:#bfeaff}</span></p>
<p class="p1"><span class="s1">.btn-ghost{background:transparent}</span></p>
<p class="p1"><span class="s1">.answers{display:grid;gap:12px}</span></p>
<p class="p1"><span class="s1">@media(min-width:640px){.answers{grid-template-columns:1fr 1fr}}</span></p>
<p class="p1"><span class="s1">.opt{padding:14px;border:1px solid #2a3347;border-radius:12px;background:#172033;cursor:pointer;text-align:left}</span></p>
<p class="p1"><span class="s1">.opt:hover{border-color:#3a4664}</span></p>
<p class="p1"><span class="s1">.opt.correct{border-color:var(--ok);background:rgba(76,175,80,.08)}</span></p>
<p class="p1"><span class="s1">.opt.wrong{border-color:var(--ng);background:rgba(239,83,80,.08)}</span></p>
<p class="p1"><span class="s1">.opt.disabled{opacity:.7;pointer-events:none}</span></p>
<p class="p1"><span class="s1">.kana{display:inline-block;min-width:2ch;text-align:center;margin-right:.5rem;color:#b8c2d8}</span></p>
<p class="p1"><span class="s1">.muted{color:var(--muted)}</span></p>
<p class="p1"><span class="s1">.bar{height:10px;background:#222a3a;border-radius:999px;overflow:hidden}</span></p>
<p class="p1"><span class="s1">.bar&gt;i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#8bd7ff);width:0%}</span></p>
<p class="p1"><span class="s1">.footer{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:16px}</span></p>
<p class="p1"><span class="s1">.chip{display:inline-flex;gap:.4rem;align-items:center;padding:6px 10px;border:1px solid #2a3246;border-radius:999px;background:#121829}</span></p>
<p class="p1"><span class="s1">.kbd{font-family:ui-monospace,Menlo,Consolas,monospace;border:1px solid #3a4563;border-radius:6px;padding:1px 6px;background:#0f1423;color:#c7d2ee}</span></p>
<p class="p1"><span class="s1">.list{margin:0;padding-left:18px}</span></p>
<p class="p1"><span class="s1">.s{opacity:.85}</span></p>
<p class="p1"><span class="s1">.tag{display:inline-block;padding:2px 8px;border:1px solid #32405a;border-radius:999px;margin-left:.5rem;font-size:12px;color:#b7c5df}</span></p>
<p class="p1"><span class="s1">.warn{color:#ffb4b4}</span></p>
<p class="p1"><span class="s1">.ok{color:#b7ffb7}</span></p>
<p class="p1"><span class="s1">.split{display:flex;gap:14px;flex-wrap:wrap}</span></p>
<p class="p1"><span class="s1">.split&gt;.grow{flex:1 1 520px}</span></p>
<p class="p1"><span class="s1">.split&gt;.side{flex:1 1 260px}</span></p>
<p class="p1"><span class="s1">.hide{display:none}</span></p>
<p class="p1"><span class="s1">.small{font-size:13px}</span></p>
<p class="p1"><span class="s1">.hr{height:1px;background:#262d40;margin:12px 0}</span></p>
<p class="p1"><span class="s1">&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="wrap"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="card pad" id="screen-start"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h1&gt;ITパスポート 過去問トレーナー &lt;span class="tag"&gt;2025r07 OCR&lt;/span&gt;&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">&lt;p class="muted s"&gt;データ：&lt;code&gt;data/itpassport_2025r07.json&lt;/code&gt;（OCR抽出。欠損は順次補完）&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="row"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="col"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h2&gt;出題モード&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;&lt;input type="radio" name="mode" value="train" checked&gt; 学習（その場採点）&lt;/label&gt;&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;&lt;input type="radio" name="mode" value="exam"&gt; 模試（最後に採点）&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="col"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h2&gt;出題数&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="countSel"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="10"&gt;10問&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="20" selected&gt;20問&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="30"&gt;30問&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="50"&gt;50問&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="all"&gt;全件&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="col"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h2&gt;出題順&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;&lt;input type="radio" name="order" value="random" checked&gt; ランダム&lt;/label&gt;&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;&lt;input type="radio" name="order" value="asc"&gt; 昇順&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="col"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h2&gt;オプション&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;&lt;input type="checkbox" id="autoNext" checked&gt; 正解で自動次へ&lt;/label&gt;&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;&lt;input type="checkbox" id="includeStubs"&gt; 解答のみの問題も含める&lt;/label&gt;&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;label class="small muted"&gt;ショートカット：&lt;span class="kbd"&gt;1–4&lt;/span&gt; 解答 / &lt;span class="kbd"&gt;N&lt;/span&gt; 次 / &lt;span class="kbd"&gt;B&lt;/span&gt; 戻&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="hr"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="row"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="col"&gt;&lt;button class="btn btn-primary" id="btnStart"&gt;開始する&lt;/button&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="col"&gt;&lt;button class="btn btn-ghost" id="btnReload"&gt;データ再読込&lt;/button&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="hr"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="small muted" id="datasetInfo"&gt;読み込み中…&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;div class="card pad hide" id="screen-quiz"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="split"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="grow"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="footer"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div&gt;&lt;strong id="titleNum"&gt;問-&lt;/strong&gt; / &lt;span id="totalNum"&gt;-&lt;/span&gt;　&lt;span class="tag" id="modeTag"&gt;TRAIN&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chip"&gt;&lt;span id="timer"&gt;--:--&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="bar" style="margin:10px 0 16px"&gt;&lt;i id="bar"&gt;&lt;/i&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="qText" style="font-size:18px;margin:8px 0 12px;white-space:pre-wrap"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="answers" id="answers"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="explain" class="small muted" style="margin-top:10px"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="footer"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="row" style="gap:8px"&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn" id="prevBtn" title="B"&gt;← 戻る&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn btn-accent" id="revealBtn"&gt;解答を表示&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn" id="skipBtn"&gt;スキップ&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn btn-primary" id="nextBtn" title="N"&gt;次へ →&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="muted small"&gt;正解：&lt;span class="ok" id="statOk"&gt;0&lt;/span&gt;　不正解：&lt;span class="warn" id="statNg"&gt;0&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="side"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h2 style="margin-top:0"&gt;ナビ&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="nav" class="small" style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="hr"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn btn-ghost" id="btnFinish"&gt;採点する（模試）/ 終了&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="small muted" style="margin-top:8px"&gt;未回答は灰、正解は緑、不正解は赤。&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;div class="card pad hide" id="screen-result"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h1&gt;結果&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">&lt;p&gt;&lt;strong id="scoreText"&gt;-&lt;/strong&gt;　&lt;span class="muted"&gt;所要：&lt;span id="elapsedText"&gt;-&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="row" style="margin:10px 0 16px"&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn btn-primary" id="retryWrong"&gt;不正解だけ復習&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn" id="retryAll"&gt;もう一度はじめる&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn" id="exportCsv"&gt;CSVを書き出し&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button class="btn btn-ghost" id="backHome"&gt;設定に戻る&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="review"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1">const DATA_URL = './data/itpassport_2025r07.json'; // ここを必要に応じて変更</span></p>
<p class="p1"><span class="s1">const KANA = ['ア','イ','ウ','エ'];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let RAW = []; // 全問題</span></p>
<p class="p1"><span class="s1">let POOL = []; // 出題対象</span></p>
<p class="p1"><span class="s1">let ORDER = [];</span></p>
<p class="p1"><span class="s1">let CUR = 0;</span></p>
<p class="p1"><span class="s1">let MODE = 'train';</span></p>
<p class="p1"><span class="s1">let AUTONEXT = true;</span></p>
<p class="p1"><span class="s1">let INCLUDE_STUBS = false;</span></p>
<p class="p1"><span class="s1">let START_TIME = 0;</span></p>
<p class="p1"><span class="s1">let TIMER_ID = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const $ = s =&gt; document.querySelector(s);</span></p>
<p class="p1"><span class="s1">const $$ = s =&gt; Array.from(document.querySelectorAll(s));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function fmtTime(sec){ const s=Math.max(0,Math.floor(sec)); const m=String(Math.floor(s/60)).padStart(2,'0'); const r=String(s%60).padStart(2,'0'); return `${m}:${r}`; }</span></p>
<p class="p1"><span class="s1">function shuffle(a){ for(let i=a.length-1;i&gt;0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function loadData(){</span></p>
<p class="p1"><span class="s1">$('#datasetInfo').textContent = '読み込み中…';</span></p>
<p class="p1"><span class="s1">try{</span></p>
<p class="p1"><span class="s1">const res = await fetch(DATA_URL,{cache:'no-store'});</span></p>
<p class="p1"><span class="s1">if(!res.ok) throw new Error(res.status+' '+res.statusText);</span></p>
<p class="p1"><span class="s1">const data = await res.json();</span></p>
<p class="p1"><span class="s1">RAW = (data.questions||[]).map(q=&gt;({...q, selected:null, result:null, seen:false}));</span></p>
<p class="p1"><span class="s1">const full = RAW.filter(q =&gt; q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4 &amp;&amp; Number.isInteger(q.answer_index));</span></p>
<p class="p1"><span class="s1">const stub = RAW.filter(q =&gt; !(q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4));</span></p>
<p class="p1"><span class="s1">$('#datasetInfo').innerHTML = `問題総数：&lt;strong&gt;${RAW.length}&lt;/strong&gt;　完全抽出：&lt;strong&gt;${full.length}&lt;/strong&gt;　スタブ：&lt;strong&gt;${stub.length}&lt;/strong&gt;`;</span></p>
<p class="p1"><span class="s1">}catch(e){</span></p>
<p class="p1"><span class="s1">$('#datasetInfo').innerHTML = `読み込み失敗：&lt;span class="warn"&gt;${e.message}&lt;/span&gt;&lt;br&gt;パス &lt;code&gt;${DATA_URL}&lt;/code&gt; と公開状態をご確認ください。`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">loadData();</span></p>
<p class="p1"><span class="s1">$('#btnReload').addEventListener('click', loadData);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">$('#btnStart').addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1">MODE = $$('input[name="mode"]').find(r=&gt;r.checked)?.value || 'train';</span></p>
<p class="p1"><span class="s1">AUTONEXT = $('#autoNext').checked;</span></p>
<p class="p1"><span class="s1">INCLUDE_STUBS = $('#includeStubs').checked;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const full = RAW.filter(q =&gt; q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4 &amp;&amp; Number.isInteger(q.answer_index));</span></p>
<p class="p1"><span class="s1">const stubs = RAW.filter(q =&gt; !(q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4));</span></p>
<p class="p1"><span class="s1">POOL = INCLUDE_STUBS ? [...full, ...stubs] : full;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if(POOL.length===0){ alert('出題できる問題がありません。JSON配置を確認してください。'); return; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const orderSel = $$( 'input[name="order"]').find(r=&gt;r.checked)?.value || 'random';</span></p>
<p class="p1"><span class="s1">ORDER = [...Array(POOL.length).keys()];</span></p>
<p class="p1"><span class="s1">if(orderSel==='random') shuffle(ORDER);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const cnt = $('#countSel').value;</span></p>
<p class="p1"><span class="s1">if(cnt!=='all') ORDER = ORDER.slice(0, Math.min(parseInt(cnt,10), ORDER.length));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">POOL.forEach(q=&gt;{ q.selected=null; q.result=null; q.seen=false; });</span></p>
<p class="p1"><span class="s1">CUR = 0; START_TIME = Date.now(); startTimer();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">$('#screen-start').classList.add('hide');</span></p>
<p class="p1"><span class="s1">$('#screen-result').classList.add('hide');</span></p>
<p class="p1"><span class="s1">$('#screen-quiz').classList.remove('hide');</span></p>
<p class="p1"><span class="s1">$('#modeTag').textContent = MODE.toUpperCase();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">renderQuestion(); renderNav();</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function startTimer(){ clearInterval(TIMER_ID); TIMER_ID = setInterval(()=&gt;$('#timer').textContent = fmtTime((Date.now()-START_TIME)/1000), 500); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderQuestion(){</span></p>
<p class="p1"><span class="s1">const idx = ORDER[CUR], q = POOL[idx];</span></p>
<p class="p1"><span class="s1">$('#titleNum').textContent = `問${q.number ?? (idx+1)}`;</span></p>
<p class="p1"><span class="s1">$('#totalNum').textContent = ORDER.length;</span></p>
<p class="p1"><span class="s1">$('#bar').style.width = `${((CUR)/Math.max(1,ORDER.length-1))*100}%`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const disabled = !!(q.result!==null || MODE==='exam');</span></p>
<p class="p1"><span class="s1">$('#qText').textContent = q.question ? q.question : '（本文未抽出：解答のみ保持のスタブ問題）';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const answersEl = $('#answers'); answersEl.innerHTML='';</span></p>
<p class="p1"><span class="s1">if(q.choices &amp;&amp; q.choices.length===4){</span></p>
<p class="p1"><span class="s1">q.choices.forEach((text,i)=&gt;{</span></p>
<p class="p1"><span class="s1">const btn = document.createElement('button');</span></p>
<p class="p1"><span class="s1">btn.className = 'opt';</span></p>
<p class="p1"><span class="s1">btn.dataset.index = i;</span></p>
<p class="p1"><span class="s1">btn.innerHTML = `&lt;span class="kana"&gt;${KANA[i]}&lt;/span&gt;${escapeHtml(text)}`;</span></p>
<p class="p1"><span class="s1">if(disabled &amp;&amp; q.selected===null) btn.classList.add('disabled');</span></p>
<p class="p1"><span class="s1">if(q.result!==null){</span></p>
<p class="p1"><span class="s1">if(i===q.answer_index) btn.classList.add('correct');</span></p>
<p class="p1"><span class="s1">if(q.selected===i &amp;&amp; !q.result) btn.classList.add('wrong');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">btn.addEventListener('click',()=&gt;selectChoice(i));</span></p>
<p class="p1"><span class="s1">answersEl.appendChild(btn);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}else{</span></p>
<p class="p1"><span class="s1">const stub = document.createElement('div');</span></p>
<p class="p1"><span class="s1">stub.className='muted';</span></p>
<p class="p1"><span class="s1">stub.textContent='選択肢未収録のため、この設問は採点対象外です。';</span></p>
<p class="p1"><span class="s1">answersEl.appendChild(stub);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">$('#explain').textContent = q.explanation ? `解説：${q.explanation}` : '';</span></p>
<p class="p1"><span class="s1">$('#prevBtn').disabled = CUR===0;</span></p>
<p class="p1"><span class="s1">$('#nextBtn').disabled = CUR&gt;=ORDER.length-1;</span></p>
<p class="p1"><span class="s1">$('#revealBtn').disabled = !(MODE==='exam' &amp;&amp; q.choices &amp;&amp; Number.isInteger(q.answer_index));</span></p>
<p class="p1"><span class="s1">$('#skipBtn').disabled = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const ok = POOL.filter(x=&gt;x.result===true).length;</span></p>
<p class="p1"><span class="s1">const ng = POOL.filter(x=&gt;x.result===false).length;</span></p>
<p class="p1"><span class="s1">$('#statOk').textContent = ok; $('#statNg').textContent = ng;</span></p>
<p class="p1"><span class="s1">q.seen=true;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function selectChoice(i){</span></p>
<p class="p1"><span class="s1">const idx = ORDER[CUR], q = POOL[idx];</span></p>
<p class="p1"><span class="s1">if(!q.choices || !Number.isInteger(q.answer_index)) return;</span></p>
<p class="p1"><span class="s1">if(MODE==='exam'){</span></p>
<p class="p1"><span class="s1">q.selected = i; renderNav();</span></p>
<p class="p1"><span class="s1">if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">q.selected = i; q.result = (i===q.answer_index);</span></p>
<p class="p1"><span class="s1">renderQuestion(); renderNav();</span></p>
<p class="p1"><span class="s1">if(AUTONEXT &amp;&amp; q.result &amp;&amp; CUR&lt;ORDER.length-1){ setTimeout(()=&gt;{ CUR++; renderQuestion(); }, 150); }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">$('#prevBtn').addEventListener('click', ()=&gt;{ if(CUR&gt;0){ CUR--; renderQuestion(); }});</span></p>
<p class="p1"><span class="s1">$('#nextBtn').addEventListener('click', ()=&gt;{ if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }});</span></p>
<p class="p1"><span class="s1">$('#skipBtn').addEventListener('click', ()=&gt;{ if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }});</span></p>
<p class="p1"><span class="s1">$('#revealBtn').addEventListener('click', ()=&gt;{</span></p>
<p class="p1"><span class="s1">const idx = ORDER[CUR], q = POOL[idx];</span></p>
<p class="p1"><span class="s1">if(!q.choices || !Number.isInteger(q.answer_index)) return;</span></p>
<p class="p1"><span class="s1">if(q.selected==null){ alert('まずどれか選択してください。'); return; }</span></p>
<p class="p1"><span class="s1">q.result = (q.selected===q.answer_index);</span></p>
<p class="p1"><span class="s1">renderQuestion(); renderNav();</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">$('#btnFinish').addEventListener('click', finish);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function finish(){</span></p>
<p class="p1"><span class="s1">clearInterval(TIMER_ID);</span></p>
<p class="p1"><span class="s1">if(MODE==='exam'){</span></p>
<p class="p1"><span class="s1">for(const q of POOL){</span></p>
<p class="p1"><span class="s1">if(q.choices &amp;&amp; Number.isInteger(q.answer_index) &amp;&amp; q.selected!=null){</span></p>
<p class="p1"><span class="s1">q.result = (q.selected===q.answer_index);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">$('#screen-quiz').classList.add('hide');</span></p>
<p class="p1"><span class="s1">$('#screen-result').classList.remove('hide');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const ok = POOL.filter(x=&gt;x.result===true).length;</span></p>
<p class="p1"><span class="s1">const count = POOL.filter(x=&gt;x.choices &amp;&amp; Number.isInteger(x.answer_index)).length;</span></p>
<p class="p1"><span class="s1">$('#scoreText').textContent = `正解 ${ok} / ${count}（${Math.round(ok/count*100)||0}%）`;</span></p>
<p class="p1"><span class="s1">$('#elapsedText').textContent = fmtTime((Date.now()-START_TIME)/1000);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const wrongs = POOL.filter(x=&gt;x.result===false).map(x=&gt;({num:x.number ?? '-', q:x.question || '（本文なし）', ans:x.answer_index, sel:x.selected}));</span></p>
<p class="p1"><span class="s1">const container = $('#review'); container.innerHTML='';</span></p>
<p class="p1"><span class="s1">if(wrongs.length===0){ container.innerHTML = '&lt;p class="ok"&gt;全問正解！&lt;/p&gt;'; }</span></p>
<p class="p1"><span class="s1">else{</span></p>
<p class="p1"><span class="s1">const ol = document.createElement('ol'); ol.className='list';</span></p>
<p class="p1"><span class="s1">wrongs.forEach(w=&gt;{</span></p>
<p class="p1"><span class="s1">const li = document.createElement('li');</span></p>
<p class="p1"><span class="s1">const ck = w.ans!=null ? KANA[w.ans] : '-';</span></p>
<p class="p1"><span class="s1">const sk = w.sel!=null ? KANA[w.sel] : '-';</span></p>
<p class="p1"><span class="s1">li.innerHTML = `&lt;strong&gt;問${w.num}&lt;/strong&gt;　&lt;small class="muted"&gt;正解:${ck} / 回答:${sk}&lt;/small&gt;&lt;br&gt;${escapeHtml(w.q)}`;</span></p>
<p class="p1"><span class="s1">ol.appendChild(li);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">container.appendChild(ol);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">$('#retryWrong').addEventListener('click', ()=&gt;{</span></p>
<p class="p1"><span class="s1">const wrongIdx = ORDER.filter(i =&gt; { const q=POOL[i]; return q.result===false &amp;&amp; q.choices &amp;&amp; Number.isInteger(q.answer_index); });</span></p>
<p class="p1"><span class="s1">if(wrongIdx.length===0){ alert('不正解がありません。'); return; }</span></p>
<p class="p1"><span class="s1">ORDER = wrongIdx; ORDER.forEach(i=&gt;{ POOL[i].selected=null; POOL[i].result=null; });</span></p>
<p class="p1"><span class="s1">CUR=0; START_TIME=Date.now(); startTimer();</span></p>
<p class="p1"><span class="s1">$('#screen-result').classList.add('hide'); $('#screen-quiz').classList.remove('hide');</span></p>
<p class="p1"><span class="s1">renderQuestion(); renderNav();</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">$('#retryAll').addEventListener('click', ()=&gt;{ $('#screen-result').classList.add('hide'); $('#screen-start').classList.remove('hide'); });</span></p>
<p class="p1"><span class="s1">$('#exportCsv').addEventListener('click', ()=&gt;{</span></p>
<p class="p1"><span class="s1">const rows = [['number','selectedKana','correctKana','result']];</span></p>
<p class="p1"><span class="s1">ORDER.forEach(i=&gt;{</span></p>
<p class="p1"><span class="s1">const q=POOL[i];</span></p>
<p class="p1"><span class="s1">const sel = q.selected!=null ? KANA[q.selected] : '';</span></p>
<p class="p1"><span class="s1">const cor = Number.isInteger(q.answer_index) ? KANA[q.answer_index] : '';</span></p>
<p class="p1"><span class="s1">const res = q.result==null ? '' : (q.result?'OK':'NG');</span></p>
<p class="p1"><span class="s1">rows.push([q.number, sel, cor, res]);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">const csv = rows.map(r=&gt;r.map(s=&gt;`"${String(s??'').replace(/"/g,'""')}"`).join(',')).join('\n');</span></p>
<p class="p1"><span class="s1">const blob = new Blob([csv],{type:'text/csv'});</span></p>
<p class="p1"><span class="s1">const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='itpassport_result.csv'; a.click(); URL.revokeObjectURL(a.href);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">$('#backHome').addEventListener('click', ()=&gt;{ $('#screen-result').classList.add('hide'); $('#screen-start').classList.remove('hide'); });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderNav(){</span></p>
<p class="p1"><span class="s1">const nav=$('#nav'); nav.innerHTML='';</span></p>
<p class="p1"><span class="s1">ORDER.forEach((i,idx)=&gt;{</span></p>
<p class="p1"><span class="s1">const q=POOL[i]; const b=document.createElement('button');</span></p>
<p class="p1"><span class="s1">b.className='btn small'; b.style.padding='6px'; b.textContent = q.number ?? (i+1);</span></p>
<p class="p1"><span class="s1">if(q.result===true){ b.style.borderColor='#2e7d32'; b.style.background='rgba(46,125,50,.15)'; }</span></p>
<p class="p1"><span class="s1">else if(q.result===false){ b.style.borderColor='#b23a3a'; b.style.background='rgba(178,58,58,.12)'; }</span></p>
<p class="p1"><span class="s1">else if(q.selected!=null){ b.style.borderColor='#3a4a6b'; } else { b.style.opacity='.75'; }</span></p>
<p class="p1"><span class="s1">if(idx===CUR){ b.style.outline='2px solid var(--accent)'; }</span></p>
<p class="p1"><span class="s1">b.addEventListener('click',()=&gt;{ CUR=idx; renderQuestion(); });</span></p>
<p class="p1"><span class="s1">nav.appendChild(b);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">window.addEventListener('keydown', (e)=&gt;{</span></p>
<p class="p1"><span class="s1">if($('#screen-quiz').classList.contains('hide')) return;</span></p>
<p class="p1"><span class="s1">if(e.key&gt;='1' &amp;&amp; e.key&lt;='4'){</span></p>
<p class="p1"><span class="s1">const i = parseInt(e.key,10)-1;</span></p>
<p class="p1"><span class="s1">const idx = ORDER[CUR]; const q = POOL[idx];</span></p>
<p class="p1"><span class="s1">if(q.choices &amp;&amp; Number.isInteger(q.answer_index)) selectChoice(i);</span></p>
<p class="p1"><span class="s1">}else if(e.key==='n' || e.key==='N'){</span></p>
<p class="p1"><span class="s1">if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }</span></p>
<p class="p1"><span class="s1">}else if(e.key==='b' || e.key==='B'){</span></p>
<p class="p1"><span class="s1">if(CUR&gt;0){ CUR--; renderQuestion(); }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function escapeHtml(s){ return String(s??'').replace(/[&amp;&lt;&gt;"']/g, m=&gt;({ '&amp;':'&amp;amp;','&lt;':'&amp;lt;','&gt;':'&amp;gt;','"':'&amp;quot;',"'":'&amp;#39;'}[m])); }</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
