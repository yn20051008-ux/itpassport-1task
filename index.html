<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="ja"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;ITパスポート 過去問トレーナー（2025r07）&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">      </span>--bg:#0f1115; --panel:#151924; --accent:#4cc9f0; --ok:#4caf50; --ng:#ef5350; --muted:#99a2b2; --text:#e6eaf2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">    </span>body{margin:0;background:linear-gradient(180deg,#0f1115,#0d1220);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}</p>
<p class="p1"><span class="Apple-converted-space">    </span>a{color:var(--accent)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.wrap{max-width:980px;margin:0 auto;padding:24px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card{background:var(--panel);border:1px solid #1f2533;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.pad{padding:20px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>h1{font-size:22px;margin:0 0 12px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>h2{font-size:18px;margin:0 0 10px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.row{display:flex;gap:14px;flex-wrap:wrap}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.col{flex:1 1 240px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:12px 16px;border:1px solid #283044;border-radius:12px;background:#1a2130;color:var(--text);cursor:pointer;font-weight:600}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn:hover{border-color:#34405a}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn[disabled]{opacity:.5;cursor:not-allowed}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn-primary{background:linear-gradient(180deg,#1c2a46,#15233c);border-color:#2d3a55}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn-accent{background:linear-gradient(180deg,#13364a,#0f2e42);border-color:#1f546c;color:#bfeaff}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn-ghost{background:transparent}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.answers{display:grid;gap:12px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media(min-width:640px){.answers{grid-template-columns:1fr 1fr}}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.opt{padding:14px;border:1px solid #2a3347;border-radius:12px;background:#172033;cursor:pointer;text-align:left}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.opt:hover{border-color:#3a4664}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.opt.correct{border-color:var(--ok);background:rgba(76,175,80,.08)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.opt.wrong{border-color:var(--ng);background:rgba(239,83,80,.08)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.opt.disabled{opacity:.7;pointer-events:none}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.kana{display:inline-block;min-width:2ch;text-align:center;margin-right:.5rem;color:#b8c2d8}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.muted{color:var(--muted)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.bar{height:10px;background:#222a3a;border-radius:999px;overflow:hidden}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.bar&gt;i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#8bd7ff);width:0%}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.footer{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:16px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.chip{display:inline-flex;gap:.4rem;align-items:center;padding:6px 10px;border:1px solid #2a3246;border-radius:999px;background:#121829}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.kbd{font-family:ui-monospace,Menlo,Consolas,monospace;border:1px solid #3a4563;border-radius:6px;padding:1px 6px;background:#0f1423;color:#c7d2ee}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.list{margin:0;padding-left:18px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.s{opacity:.85}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.tag{display:inline-block;padding:2px 8px;border:1px solid #32405a;border-radius:999px;margin-left:.5rem;font-size:12px;color:#b7c5df}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.warn{color:#ffb4b4}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.ok{color:#b7ffb7}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.split{display:flex;gap:14px;flex-wrap:wrap}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.split&gt;.grow{flex:1 1 520px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.split&gt;.side{flex:1 1 260px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hide{display:none}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.small{font-size:13px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.hr{height:1px;background:#262d40;margin:12px 0}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;div class="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="card pad" id="screen-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h1&gt;ITパスポート 過去問トレーナー &lt;span class="tag"&gt;2025r07 OCR&lt;/span&gt;&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;p class="muted s"&gt;提供データ：&lt;code&gt;data/itpassport_2025r07.json&lt;/code&gt;（OCR自動抽出。欠損は順次補完）&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;出題モード&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="radio" name="mode" value="train" checked&gt; 学習（その場採点・即フィードバック）&lt;/label&gt;&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="radio" name="mode" value="exam"&gt; 模試（最後に採点・タイマー）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;出題数&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;select id="countSel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;option value="10"&gt;10問&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;option value="20" selected&gt;20問&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;option value="30"&gt;30問&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;option value="50"&gt;50問&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;option value="all"&gt;全件&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;出題順&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="radio" name="order" value="random" checked&gt; ランダム&lt;/label&gt;&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="radio" name="order" value="asc"&gt; 昇順（問1→）&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2&gt;オプション&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="checkbox" id="autoNext" checked&gt; 学習で正解時に自動で次へ&lt;/label&gt;&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="checkbox" id="includeStubs"&gt; 解答のみの問題も含める &lt;span class="tag"&gt;上級&lt;/span&gt;&lt;/label&gt;&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label class="small muted"&gt;キーボード：&lt;span class="kbd"&gt;1-4&lt;/span&gt; 解答 / &lt;span class="kbd"&gt;N&lt;/span&gt; 次へ / &lt;span class="kbd"&gt;B&lt;/span&gt; 戻る&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="hr"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="btn btn-primary" id="btnStart"&gt;開始する&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="col"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="btn btn-ghost" id="btnReload"&gt;データ再読込&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="hr"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="small muted" id="datasetInfo"&gt;読み込み中…&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="card pad hide" id="screen-quiz"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="split"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="grow"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;&lt;strong id="titleNum"&gt;問-&lt;/strong&gt; / &lt;span id="totalNum"&gt;-&lt;/span&gt;　&lt;span class="tag" id="modeTag"&gt;TRAIN&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="chip"&gt;&lt;span id="timer"&gt;--:--&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bar" style="margin:10px 0 16px"&gt;&lt;i id="bar"&gt;&lt;/i&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="qText" style="font-size:18px;margin:8px 0 12px;white-space:pre-wrap"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="answers" id="answers"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="explain" class="small muted" style="margin-top:10px"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="row" style="gap:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="btn" id="prevBtn" title="B"&gt;← 戻る&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="btn btn-accent" id="revealBtn"&gt;解答を表示&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="btn" id="skipBtn"&gt;スキップ&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="btn btn-primary" id="nextBtn" title="N"&gt;次へ →&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="muted small"&gt;正解：&lt;span class="ok" id="statOk"&gt;0&lt;/span&gt;　不正解：&lt;span class="warn" id="statNg"&gt;0&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="side"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h2 style="margin-top:0"&gt;ナビ&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="nav" class="small" style="display:grid;grid-template-columns:repeat(5,1fr);gap:6px"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="hr"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="btn btn-ghost" id="btnFinish"&gt;採点する（模試）/ 終了&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="small muted" style="margin-top:8px"&gt;未回答は灰色、正解は緑、不正解は赤で表示されます。&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="card pad hide" id="screen-result"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h1&gt;結果&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;p&gt;&lt;strong id="scoreText"&gt;-&lt;/strong&gt;　&lt;span class="muted"&gt;所要時間：&lt;span id="elapsedText"&gt;-&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="row" style="margin:10px 0 16px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn btn-primary" id="retryWrong"&gt;不正解だけ復習&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" id="retryAll"&gt;もう一度はじめる&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" id="exportCsv"&gt;CSVを書き出し&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn btn-ghost" id="backHome"&gt;設定に戻る&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="review"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">const DATA_URL = './data/itpassport_2025r07.json'; // ここを必要に応じて変更</p>
<p class="p1">const KANA = ['ア','イ','ウ','エ'];</p>
<p class="p2"><br></p>
<p class="p1">let RAW = [];<span class="Apple-converted-space">              </span>// JSONの全問題</p>
<p class="p1">let POOL = []; <span class="Apple-converted-space">            </span>// 出題対象（本文・選択肢あり or スタブ含む）</p>
<p class="p1">let ORDER = [];<span class="Apple-converted-space">            </span>// 出題順のインデックス</p>
<p class="p1">let CUR = 0; <span class="Apple-converted-space">              </span>// 現在位置（ORDERの添字）</p>
<p class="p1">let MODE = 'train';<span class="Apple-converted-space">        </span>// train | exam</p>
<p class="p1">let AUTONEXT = true;</p>
<p class="p1">let INCLUDE_STUBS = false;</p>
<p class="p1">let START_TIME = 0;</p>
<p class="p1">let TIMER_ID = null;</p>
<p class="p2"><br></p>
<p class="p1">const $ = sel =&gt; document.querySelector(sel);</p>
<p class="p1">const $$ = sel =&gt; Array.from(document.querySelectorAll(sel));</p>
<p class="p2"><br></p>
<p class="p1">function fmtTime(sec){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const s = Math.max(0, Math.floor(sec));</p>
<p class="p1"><span class="Apple-converted-space">  </span>const m = Math.floor(s/60).toString().padStart(2,'0');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const r = (s%60).toString().padStart(2,'0');</p>
<p class="p1"><span class="Apple-converted-space">  </span>return `${m}:${r}`;</p>
<p class="p1">}</p>
<p class="p1">function shuffle(arr){</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=arr.length-1;i&gt;0;i--){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const j = Math.floor(Math.random()*(i+1));</p>
<p class="p1"><span class="Apple-converted-space">    </span>[arr[i],arr[j]]=[arr[j],arr[i]];</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>return arr;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function loadData(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#datasetInfo').textContent = '読み込み中…';</p>
<p class="p1"><span class="Apple-converted-space">  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const res = await fetch(DATA_URL,{cache:'no-store'});</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!res.ok) throw new Error(res.status+' '+res.statusText);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const data = await res.json();</p>
<p class="p1"><span class="Apple-converted-space">    </span>RAW = (data.questions||[]).map(q =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">      </span>...q,</p>
<p class="p1"><span class="Apple-converted-space">      </span>selected: null, <span class="Apple-converted-space">  </span>// ユーザー選択（0..3）</p>
<p class="p1"><span class="Apple-converted-space">      </span>result: null, <span class="Apple-converted-space">    </span>// true/false/null</p>
<p class="p1"><span class="Apple-converted-space">      </span>seen: false</p>
<p class="p1"><span class="Apple-converted-space">    </span>}));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const full = RAW.filter(q =&gt; q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4 &amp;&amp; Number.isInteger(q.answer_index));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const stub = RAW.filter(q =&gt; !(q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4));</p>
<p class="p1"><span class="Apple-converted-space">    </span>$('#datasetInfo').innerHTML =</p>
<p class="p1"><span class="Apple-converted-space">      </span>`問題総数：&lt;strong&gt;${RAW.length}&lt;/strong&gt;　完全抽出：&lt;strong&gt;${full.length}&lt;/strong&gt;　スタブ：&lt;strong&gt;${stub.length}&lt;/strong&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}catch(e){</p>
<p class="p1"><span class="Apple-converted-space">    </span>$('#datasetInfo').innerHTML = `読み込み失敗：&lt;span class="warn"&gt;${e.message}&lt;/span&gt;&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>パス &lt;code&gt;${DATA_URL}&lt;/code&gt; と CORS（GitHub Pages で公開されているか）をご確認ください。`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">}</p>
<p class="p1">loadData();</p>
<p class="p2"><br></p>
<p class="p1">$('#btnReload').addEventListener('click', loadData);</p>
<p class="p2"><br></p>
<p class="p1">$('#btnStart').addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>MODE = $$('input[name="mode"]').find(r=&gt;r.checked)?.value || 'train';</p>
<p class="p1"><span class="Apple-converted-space">  </span>AUTONEXT = $('#autoNext').checked;</p>
<p class="p1"><span class="Apple-converted-space">  </span>INCLUDE_STUBS = $('#includeStubs').checked;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const full = RAW.filter(q =&gt; q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4 &amp;&amp; Number.isInteger(q.answer_index));</p>
<p class="p1"><span class="Apple-converted-space">  </span>const stubs = RAW.filter(q =&gt; !(q.question &amp;&amp; q.choices &amp;&amp; q.choices.length===4));</p>
<p class="p1"><span class="Apple-converted-space">  </span>POOL = INCLUDE_STUBS ? [...full, ...stubs] : full;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if(POOL.length===0){</p>
<p class="p1"><span class="Apple-converted-space">    </span>alert('出題できる問題がありません。JSONの配置をご確認ください。');</p>
<p class="p1"><span class="Apple-converted-space">    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const orderSel = $$('input[name="order"]').find(r=&gt;r.checked)?.value || 'random';</p>
<p class="p1"><span class="Apple-converted-space">  </span>ORDER = [...Array(POOL.length).keys()];</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(orderSel==='random') shuffle(ORDER);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const countSel = $('#countSel').value;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(countSel!=='all') ORDER = ORDER.slice(0, Math.min(parseInt(countSel,10), ORDER.length));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// リセット</p>
<p class="p1"><span class="Apple-converted-space">  </span>POOL.forEach(q =&gt; { q.selected=null; q.result=null; q.seen=false; });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>CUR = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>START_TIME = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">  </span>startTimer();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-start').classList.add('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-result').classList.add('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-quiz').classList.remove('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#modeTag').textContent = MODE.toUpperCase();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>renderQuestion();</p>
<p class="p1"><span class="Apple-converted-space">  </span>renderNav();</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">function startTimer(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>clearInterval(TIMER_ID);</p>
<p class="p1"><span class="Apple-converted-space">  </span>TIMER_ID = setInterval(()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sec = (Date.now()-START_TIME)/1000;</p>
<p class="p1"><span class="Apple-converted-space">    </span>$('#timer').textContent = fmtTime(sec);</p>
<p class="p1"><span class="Apple-converted-space">  </span>},500);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function renderQuestion(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const idx = ORDER[CUR];</p>
<p class="p1"><span class="Apple-converted-space">  </span>const q = POOL[idx];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#titleNum').textContent = `問${q.number ?? (idx+1)}`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#totalNum').textContent = ORDER.length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#bar').style.width = `${((CUR)/Math.max(1,ORDER.length-1))*100}%`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const disabled = !!(q.result!==null || MODE==='exam'); // 模試中はロック（解答表示まで）</p>
<p class="p1"><span class="Apple-converted-space">  </span>const qText = q.question ? q.question : '（この問題はスタブです。本文は未抽出。解答のみ保持）';</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#qText').textContent = qText;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const answersEl = $('#answers');</p>
<p class="p1"><span class="Apple-converted-space">  </span>answersEl.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(q.choices &amp;&amp; q.choices.length===4){</p>
<p class="p1"><span class="Apple-converted-space">    </span>q.choices.forEach((text,i)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const btn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.className = 'opt';</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.dataset.index = i;</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.innerHTML = `&lt;span class="kana"&gt;${KANA[i]}&lt;/span&gt;${escapeHtml(text)}`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(disabled &amp;&amp; q.selected===null) btn.classList.add('disabled');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if(q.result!==null){</p>
<p class="p1"><span class="Apple-converted-space">        </span>if(i===q.answer_index) btn.classList.add('correct');</p>
<p class="p1"><span class="Apple-converted-space">        </span>if(q.selected===i &amp;&amp; !q.result) btn.classList.add('wrong');</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>btn.addEventListener('click',()=&gt;selectChoice(i));</p>
<p class="p1"><span class="Apple-converted-space">      </span>answersEl.appendChild(btn);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>}else{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const stub = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">    </span>stub.className='muted';</p>
<p class="p1"><span class="Apple-converted-space">    </span>stub.textContent='選択肢が未収録のため、この設問は採点対象外です。';</p>
<p class="p1"><span class="Apple-converted-space">    </span>answersEl.appendChild(stub);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#explain').textContent = q.explanation ? `解説：${q.explanation}` : '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// ボタン状態</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#prevBtn').disabled = CUR===0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#nextBtn').disabled = CUR&gt;=ORDER.length-1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#revealBtn').disabled = !(MODE==='exam' &amp;&amp; q.choices &amp;&amp; Number.isInteger(q.answer_index));</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#skipBtn').disabled = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// 統計</p>
<p class="p1"><span class="Apple-converted-space">  </span>const ok = POOL.filter(x=&gt;x.result===true).length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const ng = POOL.filter(x=&gt;x.result===false).length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#statOk').textContent = ok;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#statNg').textContent = ng;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>q.seen=true;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function selectChoice(i){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const idx = ORDER[CUR];</p>
<p class="p1"><span class="Apple-converted-space">  </span>const q = POOL[idx];</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!q.choices || !Number.isInteger(q.answer_index)) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(MODE==='exam'){ // 模試中は選択だけ記録（採点は最後）</p>
<p class="p1"><span class="Apple-converted-space">    </span>q.selected = i;</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderNav();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(CUR&lt;ORDER.length-1) { CUR++; renderQuestion(); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>// 学習モード：即採点</p>
<p class="p1"><span class="Apple-converted-space">  </span>q.selected = i;</p>
<p class="p1"><span class="Apple-converted-space">  </span>q.result = (i===q.answer_index);</p>
<p class="p1"><span class="Apple-converted-space">  </span>renderQuestion();</p>
<p class="p1"><span class="Apple-converted-space">  </span>renderNav();</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(AUTONEXT &amp;&amp; q.result &amp;&amp; CUR&lt;ORDER.length-1){</p>
<p class="p1"><span class="Apple-converted-space">    </span>setTimeout(()=&gt;{ CUR++; renderQuestion(); }, 150);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">$('#prevBtn').addEventListener('click', ()=&gt;{ if(CUR&gt;0){ CUR--; renderQuestion(); }});</p>
<p class="p1">$('#nextBtn').addEventListener('click', ()=&gt;{ if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }});</p>
<p class="p1">$('#skipBtn').addEventListener('click', ()=&gt;{ if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }});</p>
<p class="p1">$('#revealBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>// 模試中に1問だけ答え合わせしたいとき</p>
<p class="p1"><span class="Apple-converted-space">  </span>const idx = ORDER[CUR];</p>
<p class="p1"><span class="Apple-converted-space">  </span>const q = POOL[idx];</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!q.choices || !Number.isInteger(q.answer_index)) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(q.selected==null){ alert('まずどれか選択してください。'); return; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>q.result = (q.selected===q.answer_index);</p>
<p class="p1"><span class="Apple-converted-space">  </span>renderQuestion(); renderNav();</p>
<p class="p1">});</p>
<p class="p1">$('#btnFinish').addEventListener('click', finish);</p>
<p class="p2"><br></p>
<p class="p1">function finish(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>clearInterval(TIMER_ID);</p>
<p class="p1"><span class="Apple-converted-space">  </span>// 模試：採点</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(MODE==='exam'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>for(const q of POOL){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(q.choices &amp;&amp; Number.isInteger(q.answer_index) &amp;&amp; q.selected!=null){</p>
<p class="p1"><span class="Apple-converted-space">        </span>q.result = (q.selected===q.answer_index);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>// 結果画面へ</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-quiz').classList.add('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-result').classList.remove('hide');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const ok = POOL.filter(x=&gt;x.result===true).length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const count = POOL.filter(x=&gt;x.choices &amp;&amp; Number.isInteger(x.answer_index)).length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#scoreText').textContent = `正解 ${ok} / ${count}（${Math.round(ok/count*100)||0}%）`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const sec = (Date.now()-START_TIME)/1000;</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#elapsedText').textContent = fmtTime(sec);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// 不正解一覧作成</p>
<p class="p1"><span class="Apple-converted-space">  </span>const wrongs = POOL</p>
<p class="p1"><span class="Apple-converted-space">    </span>.filter(x=&gt;x.result===false)</p>
<p class="p1"><span class="Apple-converted-space">    </span>.map(x =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">      </span>num: x.number ?? '-',</p>
<p class="p1"><span class="Apple-converted-space">      </span>q: x.question || '（本文なし）',</p>
<p class="p1"><span class="Apple-converted-space">      </span>ans: x.answer_index,</p>
<p class="p1"><span class="Apple-converted-space">      </span>sel: x.selected</p>
<p class="p1"><span class="Apple-converted-space">    </span>}));</p>
<p class="p1"><span class="Apple-converted-space">  </span>const container = $('#review');</p>
<p class="p1"><span class="Apple-converted-space">  </span>container.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(wrongs.length===0){</p>
<p class="p1"><span class="Apple-converted-space">    </span>container.innerHTML = '&lt;p class="ok"&gt;全問正解！&lt;/p&gt;';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}else{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ul = document.createElement('ol');</p>
<p class="p1"><span class="Apple-converted-space">    </span>ul.className='list';</p>
<p class="p1"><span class="Apple-converted-space">    </span>wrongs.forEach(w=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">      </span>const li = document.createElement('li');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const correctKana = w.ans!=null ? KANA[w.ans] : '-';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const selKana = w.sel!=null ? KANA[w.sel] : '-';</p>
<p class="p1"><span class="Apple-converted-space">      </span>li.innerHTML = `&lt;strong&gt;問${w.num}&lt;/strong&gt;　&lt;small class="muted"&gt;正解:${correctKana} / 回答:${selKana}&lt;/small&gt;&lt;br&gt;${escapeHtml(w.q)}`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ul.appendChild(li);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>container.appendChild(ul);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">$('#retryWrong').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>// 不正解のみで再挑戦</p>
<p class="p1"><span class="Apple-converted-space">  </span>const wrongIdx = ORDER.filter(i =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const q = POOL[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>return q.result===false &amp;&amp; q.choices &amp;&amp; Number.isInteger(q.answer_index);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(wrongIdx.length===0){ alert('不正解がありません。'); return; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>ORDER = wrongIdx;</p>
<p class="p1"><span class="Apple-converted-space">  </span>ORDER.forEach(i =&gt; { POOL[i].selected=null; POOL[i].result=null; });</p>
<p class="p1"><span class="Apple-converted-space">  </span>CUR = 0; START_TIME = Date.now(); startTimer();</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-result').classList.add('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-quiz').classList.remove('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>renderQuestion(); renderNav();</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">$('#retryAll').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-result').classList.add('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-start').classList.remove('hide');</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">$('#exportCsv').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rows = [['number','selectedKana','correctKana','result']];</p>
<p class="p1"><span class="Apple-converted-space">  </span>ORDER.forEach(i=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const q = POOL[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const selKana = q.selected!=null ? KANA[q.selected] : '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const corKana = Number.isInteger(q.answer_index) ? KANA[q.answer_index] : '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const res = q.result==null ? '' : (q.result?'OK':'NG');</p>
<p class="p1"><span class="Apple-converted-space">    </span>rows.push([q.number, selKana, corKana, res]);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const csv = rows.map(r=&gt;r.map(s=&gt;`"${String(s??'').replace(/"/g,'""')}"`).join(',')).join('\n');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const blob = new Blob([csv],{type:'text/csv'});</p>
<p class="p1"><span class="Apple-converted-space">  </span>const a = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.href = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.download = 'itpassport_result.csv';</p>
<p class="p1"><span class="Apple-converted-space">  </span>a.click();</p>
<p class="p1"><span class="Apple-converted-space">  </span>URL.revokeObjectURL(a.href);</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">$('#backHome').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-result').classList.add('hide');</p>
<p class="p1"><span class="Apple-converted-space">  </span>$('#screen-start').classList.remove('hide');</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">function renderNav(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const nav = $('#nav');</p>
<p class="p1"><span class="Apple-converted-space">  </span>nav.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>ORDER.forEach((i,idx)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const q = POOL[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const b = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">    </span>b.className='btn small';</p>
<p class="p1"><span class="Apple-converted-space">    </span>b.style.padding='6px';</p>
<p class="p1"><span class="Apple-converted-space">    </span>b.textContent = q.number ?? (i+1);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(q.result===true){ b.style.borderColor='#2e7d32'; b.style.background='rgba(46,125,50,.15)'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if(q.result===false){ b.style.borderColor='#b23a3a'; b.style.background='rgba(178,58,58,.12)'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if(q.selected!=null){ b.style.borderColor='#3a4a6b'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>else { b.style.opacity='.75'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(idx===CUR){ b.style.outline='2px solid var(--accent)'; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>b.addEventListener('click',()=&gt;{ CUR=idx; renderQuestion(); });</p>
<p class="p1"><span class="Apple-converted-space">    </span>nav.appendChild(b);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Keyboard shortcuts</p>
<p class="p1">window.addEventListener('keydown', (e)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>if($('#screen-quiz').classList.contains('hide')) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(e.key&gt;='1' &amp;&amp; e.key&lt;='4'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const i = parseInt(e.key,10)-1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const idx = ORDER[CUR];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const q = POOL[idx];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(q.choices &amp;&amp; Number.isInteger(q.answer_index)) selectChoice(i);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}else if(e.key==='n' || e.key==='N'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(CUR&lt;ORDER.length-1){ CUR++; renderQuestion(); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>}else if(e.key==='b' || e.key==='B'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(CUR&gt;0){ CUR--; renderQuestion(); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">function escapeHtml(s){</p>
<p class="p1"><span class="Apple-converted-space">  </span>return String(s??'').replace(/[&amp;&lt;&gt;"']/g, m=&gt;({ '&amp;':'&amp;amp;','&lt;':'&amp;lt;','&gt;':'&amp;gt;','"':'&amp;quot;',"'":'&amp;#39;'}[m]));</p>
<p class="p1">}</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
