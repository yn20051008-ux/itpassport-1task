<!doctype html>
<html lang="ja"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ITパスポート過去問トレーナー｜Mock 100 (abs fetch)</title>
<style>
  :root{--bg:#0a0f1a;--panel:#0e1626;--panel-2:#101a30;--text:#eaf1ff;--muted:#a6b5d5;--brand1:#6de1ff;--brand2:#9b7bff;--ok:#3be57f;--warn:#ff6574;--line:#1f2a44;--chip:#0e213e}
  *{box-sizing:border-box}body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0a0f1a;color:#eaf1ff}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  .card{background:linear-gradient(180deg,#0e1626,#101a30);border:1px solid #1f2a44;border-radius:16px;padding:16px}
  .btn{border:1px solid #1f2a44;border-radius:12px;background:#111b33;color:#fff;padding:10px 14px;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,#6de1ff,#9b7bff);border-color:transparent;color:#06101f;font-weight:800}
  .choice{border:1px solid #1f2a44;background:#0d1426;border-radius:12px;padding:12px;display:flex;gap:10px;align-items:center;margin:8px 0;cursor:pointer}
  .choice .k{min-width:28px;height:28px;border:1px solid #1f2a44;border-radius:8px;display:grid;place-items:center;background:#0f223f;font-weight:800}
  .good{border-color:#22c55e;box-shadow:0 0 0 1px #22c55e inset}
  .bad{border-color:#e23e57;box-shadow:0 0 0 1px #e23e57 inset}
</style></head>
<body>
<div class="wrap">
  <div class="card">
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <span>出題数 <input id="examCount" type="number" value="100" min="1" style="width:80px;background:transparent;color:#fff;border:none"></span>
      <span>制限 <input id="examMinutes" type="number" value="120" min="1" style="width:80px;background:transparent;color:#fff;border:none"> 分</span>
      <label><input id="shuffle" type="checkbox" checked> 出題シャッフル</label>
      <button id="btnStart" class="btn primary" type="button">模試開始</button>
      <span id="meta" style="margin-left:auto;opacity:.7"></span>
    </div>
  </div>
  <div id="quiz" class="card" style="margin-top:12px;display:none">
    <div id="counter" style="opacity:.75"></div>
    <h3 id="stem" style="margin:8px 0 12px">-</h3>
    <div id="choices"></div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="btnPrev" class="btn">← 戻る</button>
      <button id="btnFinish" class="btn">採点</button>
    </div>
  </div>
</div>
<script>
const $=s=>document.querySelector(s), H=(t,a={},...c)=>{const e=document.createElement(t);for(const k in a){if(k.startsWith('on')) e.addEventListener(k.slice(2),a[k]);else if(k==='html')e.innerHTML=a[k];else e.setAttribute(k,a[k]);}c.forEach(n=>e.append(n));return e};
const LABELS=['ア','イ','ウ','エ'];
const ABS_URL = new URL('data/questions.json?v='+Date.now(), location.href).toString();
console.log('[trainer] fetch:', ABS_URL);
async function loadQ(){
  try{
    const r=await fetch(ABS_URL,{cache:'no-store'});
    console.log('[trainer] status:', r.status);
    if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json();
    if(Array.isArray(j)&&j.length){ console.log('[trainer] loaded', j.length); return j; }
  }catch(e){
    console.warn('[trainer] failed to load questions.json:', e);
  }
  // fallback dummy
  const out=[]; for(let i=1;i<=100;i++){ const k=LABELS[(i-1)%4]; out.push({year:new Date().getFullYear(),session:'AUTO',q_no:i,stem:'ダミー問題 '+i+'（fallback）',ア:'選択肢ア',イ:'選択肢イ',ウ:'選択肢ウ',エ:'選択肢エ',answer_kana:k}); }
  return out;
}
let Q=[],IDX=0,EXCNT=100,LOCK=false,ANS={};
$('#btnStart').onclick=async()=>{
  EXCNT=+$('#examCount').value||100;
  let qs=await loadQ();
  if($('#shuffle').checked) qs=shuffle(qs);
  Q=qs.slice(0,EXCNT); ANS={}; IDX=0;
  $('#quiz').style.display='block';
  render();
}
$('#btnPrev').onclick=()=>{ if(LOCK||IDX<=0) return; IDX--; render(); }
$('#btnFinish').onclick=()=>alert('finish');
function render(){
  const q=Q[IDX]; $('#counter').textContent=(IDX+1)+' / '+Q.length; $('#meta').textContent=(q.year||'-')+' '+(q.session||'')+' | '+(q.domain||'-'); $('#stem').textContent=q.stem||'';
  const c=$('#choices'); c.innerHTML='';
  [q.ア,q.イ,q.ウ,q.エ].forEach((t,i)=>{
    const k=LABELS[i];
    c.append(H('button',{class:'choice',type:'button','data-kana':k,onclick:()=>choose(k)},H('span',{class:'k'},k),' ',t||''));
  });
}
function choose(k){
  const q=Q[IDX], c=q.answer_kana||mapKana(q.answer)||'';
  const wrap=$('#choices'), okEl=wrap.querySelector('[data-kana="'+c+'"]'), meEl=wrap.querySelector('[data-kana="'+k+'"]');
  if(okEl) okEl.classList.add('good'); if(k!==c&&meEl) meEl.classList.add('bad');
  setTimeout(()=>{ if(IDX<Q.length-1){IDX++; render();} }, 450);
}
function mapKana(ch){ return ({A:'ア',B:'イ',C:'ウ',D:'エ'}[ch]||''); }
function shuffle(a){const b=[...a]; for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [b[i],b[j]]=[b[j],b[i]];} return b;}
</script>
</body></html>
