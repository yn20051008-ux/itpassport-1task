<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ITパス 練習（シンプル＆スピード）</title>
<style>
  :root{
    --bg:#0b1017;            /* 背景 */
    --card:#121a24;          /* カード */
    --muted:#7a8aa0;         /* サブ文字 */
    --text:#e8f0f7;          /* 主要文字 */
    --ok:#22c55e;            /* 正解 */
    --ng:#ef4444;            /* 不正解 */
    --accent:#334155;        /* 行の枠 */
    --choice:#17212b;        /* 選択肢の面 */
    --choiceHover:#1e2a37;   /* hover */
    --label:#0f172a;         /* あ/い/う/えの円 */
    --labelText:#ffffff;     /* 円の文字（固定白） */
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
      Roboto, "Noto Sans JP", "Hiragino Sans", "ヒラギノ角ゴ ProN W3",
      "Yu Gothic UI","メイリオ", Arial, sans-serif;
    -webkit-font-smoothing:antialiased;
  }
  .wrap{max-width:900px;margin:0 auto;padding:20px}
  .header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    position:sticky;top:0;background:linear-gradient(180deg,var(--bg) 70%,#0000);
    z-index:10;padding-bottom:8px;
  }
  .brand{font-weight:700;letter-spacing:.5px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chip{
    display:inline-flex;align-items:center;gap:8px;
    padding:6px 10px;border-radius:999px;background:#0f172a;border:1px solid #203040;
    font-size:13px;color:var(--muted)
  }
  .chip .dot{width:10px;height:10px;border-radius:50%}
  .chip.ok .dot{background:var(--ok)}
  .chip.ng .dot{background:var(--ng)}
  .chip.time{font-variant-numeric:tabular-nums}
  .screen{display:none}
  .screen.active{display:block}
  .card{
    background:var(--card); border:1px solid #1b2735; border-radius:18px;
    padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35);
  }
  h1{margin:.2em 0 .4em 0;font-size:22px}
  .sub{color:var(--muted);font-size:14px}
  .start-grid{display:grid;gap:16px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .row input[type="number"]{
    width:110px;background:#0f172a;color:var(--text);
    border:1px solid #223347;border-radius:10px;padding:10px 12px;font-size:14px
  }
  .btn{
    background:#0f172a;color:#e8f0f7;border:1px solid #294057;
    padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer;
  }
  .btn:hover{background:#152131}
  .question-title{font-size:18px;line-height:1.6;margin:0 0 14px 0}
  .choices{display:grid;gap:10px}
  .choice{
    display:flex;gap:12px;align-items:flex-start;
    background:var(--choice);border:1px solid var(--accent);
    border-radius:14px;padding:14px 14px;cursor:pointer;
    transition:transform .04s ease, background .15s ease, border-color .15s ease;
  }
  .choice:hover{background:var(--choiceHover);transform:translateY(-1px)}
  .choice.disabled{pointer-events:none;opacity:.8}
  .choice .label{
    min-width:28px;height:28px;display:inline-grid;place-items:center;
    border-radius:999px;background:var(--label);color:var(--labelText);
    font-weight:700
  }
  .choice.correct{border-color:var(--ok);outline:2px solid color-mix(in srgb, var(--ok) 35%, transparent)}
  .choice.wrong{border-color:var(--ng);outline:2px solid color-mix(in srgb, var(--ng) 35%, transparent)}
  .result h2{margin:.2em 0 .3em 0}
  .result .kpi{display:flex;gap:10px;flex-wrap:wrap}
  .kbd{background:#0f172a;border:1px solid #223347;border-radius:6px;padding:2px 6px;font-size:12px}
  .meta{margin-top:6px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">ITパス 練習</div>
      <div class="chips">
        <div class="chip ok"><span class="dot"></span><span>正解</span> <strong id="ok">0</strong></div>
        <div class="chip ng"><span class="dot"></span><span>不正解</span> <strong id="ng">0</strong></div>
        <div class="chip time">残り <strong id="time">--:--</strong></div>
      </div>
    </div>

    <!-- Start -->
    <section id="screen-start" class="screen active">
      <div class="card start-grid">
        <h1>シンプルクール &times; 反復最速</h1>
        <div class="sub">過去問を“選ぶ→即判定→自動次問”。手を止めない学習体験。</div>
        <div class="row">
          <div>出題数：<strong id="qcount">0</strong> 問</div>
          <div class="meta">（順番は1→100。データ順をそのまま出題）</div>
        </div>
        <div class="row">
          <label for="minutes">制限時間：</label>
          <input id="minutes" type="number" min="1" max="999" value="20" /> 分
          <button class="btn" id="btnStart">開始する</button>
        </div>
        <div class="meta">ショートカット：<span class="kbd">1–4</span> 選択 / <span class="kbd">Enter</span> 次へ</div>
      </div>
    </section>

    <!-- Quiz -->
    <section id="screen-quiz" class="screen">
      <div class="card">
        <div id="qtitle" class="question-title"></div>
        <div id="choices" class="choices"></div>
        <div id="comment" class="sub" style="margin-top:12px;display:none"></div>
        <div class="meta" id="progress"></div>
      </div>
    </section>

    <!-- Result -->
    <section id="screen-result" class="screen">
      <div class="card result">
        <h2>おつかれさま！</h2>
        <div class="kpi">
          <div class="chip ok"><span class="dot"></span>正解 <strong id="ok2">0</strong></div>
          <div class="chip ng"><span class="dot"></span>不正解 <strong id="ng2">0</strong></div>
          <div class="chip time">所要 <strong id="spent">--:--</strong></div>
        </div>
        <div class="row" style="margin-top:12px">
          <button class="btn" id="btnRetry">もう一度</button>
        </div>
      </div>
    </section>
  </div>

  <!-- ★ここに“元データ”を貼る：配列だけを置き換えてください -->
  <script id="raw-data" type="application/json">
  [
    {
      "number": 1,
      "question": "ダミー問題：要件定義とはどれか。",
      "choices": ["基本設計","詳細設計","要件定義","運用・保守"],
      "answer_index": 2,
      "comment": "利用者の要求を分析し、機能や制約を明確化する工程。"
    }
    /* ←この配列 entirety をあなたの 1〜100問に置き換えます（例は削除OK） */
  ]
  </script>

<script>
(function(){
  "use strict";

  // ---------- Helpers ----------
  const $ = s=>document.querySelector(s);
  const $$ = s=>document.querySelectorAll(s);
  const screens = {
    start: $('#screen-start'),
    quiz:  $('#screen-quiz'),
    result:$('#screen-result')
  };
  const kana = ['あ','い','う','え','お','か','き','く','け','こ']; // 4択想定だが10まで用意
  const timeEl = $('#time'), okEl=$('#ok'), ngEl=$('#ng');

  let qs=[], idx=0, ok=0, ng=0, timer=null, endAt=0, startedAt=0, autoNextTO=null;

  function show(name){
    Object.values(screens).forEach(x=>x.classList.remove('active'));
    screens[name].classList.add('active');
  }
  function formatSec(s){
    s=Math.max(0,Math.floor(s));
    const m=String(Math.floor(s/60)).padStart(2,'0');
    const ss=String(s%60).padStart(2,'0');
    return `${m}:${ss}`;
  }
  function loadData(){
    const raw = $('#raw-data')?.textContent?.trim();
    if(!raw) return [];
    try{
      const parsed = JSON.parse(raw);
      if(Array.isArray(parsed)) return parsed;
      if(parsed && Array.isArray(parsed.questions)) return parsed.questions;
      console.warn('未知の形式。配列を期待します。');
      return [];
    }catch(e){
      console.error('JSON parse error', e);
      return [];
    }
  }
  function validateData(arr){
    return arr.filter((q,i)=>{
      const ok = q && typeof q.number==='number' && typeof q.question==='string'
        && Array.isArray(q.choices) && q.choices.length>=2
        && Number.isInteger(q.answer_index) && q.answer_index>=0 && q.answer_index<q.choices.length;
      if(!ok) console.warn('無効なアイテムをスキップ:', i, q);
      return ok;
    });
  }

  // ---------- Start screen ----------
  function initStart(){
    qs = validateData(loadData());
    $('#qcount').textContent = qs.length.toString();
    show('start');
  }

  // ---------- Quiz flow ----------
  function startQuiz(){
    idx=0; ok=0; ng=0;
    okEl.textContent='0'; ngEl.textContent='0';
    $('#comment').style.display='none';
    const minutes = Math.max(1, parseInt($('#minutes').value||'20',10));
    startedAt = Date.now();
    endAt = startedAt + minutes*60*1000;
    updateTime(); timer = setInterval(updateTime, 200);
    render();
    show('quiz');
  }

  function endQuiz(reason='done'){
    clearInterval(timer); timer=null;
    clearTimeout(autoNextTO);
    $('#ok2').textContent=ok; $('#ng2').textContent=ng;
    const spent = Math.round((Date.now()-startedAt)/1000);
    $('#spent').textContent = formatSec(spent);
    show('result');
  }

  function updateTime(){
    const left = Math.ceil((endAt - Date.now())/1000);
    timeEl.textContent = formatSec(left);
    if(left<=0){ timeEl.textContent='00:00'; endQuiz('timeup'); }
  }

  function render(){
    const q = qs[idx];
    $('#qtitle').textContent = `Q${idx+1} / ${qs.length}（元番号: ${q.number ?? (idx+1)}）\n` + q.question;
    $('#progress').textContent = `進捗 ${idx+1} / ${qs.length}`;
    const box = $('#choices'); box.innerHTML='';
    const comment = $('#comment'); comment.style.display='none'; comment.textContent = q.comment||'';

    q.choices.forEach((txt,i)=>{
      const row = document.createElement('div');
      row.className='choice';
      row.setAttribute('data-idx', i);
      row.innerHTML = `<div class="label">${kana[i] ?? (i+1)}</div><div class="txt">${txt}</div>`;
      row.addEventListener('click', ()=>choose(i));
      box.appendChild(row);
    });
    // keyboard (1-4)
    document.onkeydown = (e)=>{
      if(['1','2','3','4'].includes(e.key)){
        const n = parseInt(e.key,10)-1;
        if(n<q.choices.length) choose(n);
      }else if(e.key==='Enter'){
        if(idx<qs.length-1) next(); else endQuiz();
      }
    }
  }

  function choose(i){
    const q = qs[idx];
    const correct = q.answer_index;
    // lock
    $$('#choices .choice').forEach(el=>el.classList.add('disabled'));
    if(i===correct){ ok++; okEl.textContent=ok; }
    else { ng++; ngEl.textContent=ng; }

    // paint
    const rows = $$('#choices .choice');
    rows[correct]?.classList.add('correct');
    if(i!==correct) rows[i]?.classList.add('wrong');

    // comment
    if(q.comment){ const c=$('#comment'); c.style.display='block'; }

    // auto next
    clearTimeout(autoNextTO);
    autoNextTO = setTimeout(()=> next(), 700);
  }

  function next(){
    if(idx < qs.length-1){
      idx++; render();
    }else{
      endQuiz();
    }
  }

  // ---------- Wire UI ----------
  $('#btnStart').addEventListener('click', ()=>{
    if(qs.length===0){ alert('問題データがありません。<script id="raw-data"> に配列を貼ってください。'); return; }
    startQuiz();
  });
  $('#btnRetry').addEventListener('click', ()=>{ initStart(); });

  // first
  initStart();
})();
</script>
</body>
</html>
