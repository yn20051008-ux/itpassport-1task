<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ITパス反復練習</title>
  <style>
    :root{
      --bg:#0f1216; --card:#151a20; --muted:#8aa0b4; --txt:#e9f0f6;
      --ok:#2ecc71; --ng:#e74c3c; --btn:#202732; --btn-emp:#2d7df6;
      --chip:#1b2230; --chip-b:#2a3344;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .wrap{max-width:980px;margin:0 auto;padding:20px;}
    h1{font-size:22px;margin:0 0 8px 0}
    .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:12px 0 18px}
    .chip{background:var(--chip);border:1px solid var(--chip-b);border-radius:999px;padding:6px 10px;font-size:13px}
    .control{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select{appearance:none;background:var(--btn);color:var(--txt);border:1px solid #2b3544;border-radius:10px;padding:8px 12px;font-size:14px}
    button{background:var(--btn);color:var(--txt);border:1px solid #2b3544;border-radius:12px;padding:10px 16px;font-size:15px;cursor:pointer}
    button.primary{background:var(--btn-emp);border-color:transparent}
    button:disabled{opacity:.5;cursor:not-allowed}

    .card{background:var(--card);border:1px solid #222b36;border-radius:16px;padding:16px 16px 12px}
    .qheader{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;margin-bottom:8px}
    .qtext{white-space:pre-wrap;line-height:1.7;font-size:16px;margin:6px 0 12px}
    .choices{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
    .choice{background:#0f141b;border:1px solid #222b36;border-radius:12px;padding:10px 12px;font-size:15px}
    .keys{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .keybtn{padding:12px 0;border-radius:12px;text-align:center;background:var(--btn);border:1px solid #2b3544;font-weight:700}
    .keybtn.ok{background:#103a27;border-color:#1d7a54}
    .keybtn.ng{background:#3a1212;border-color:#7a1d1d}
    .muted{color:var(--muted)}
    .foot{display:flex;gap:10px;align-items:center;margin-top:16px}
    .spacer{flex:1}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ITパス反復練習</h1>

    <div class="bar">
      <span class="chip">正解 <b id="scoreOk">0</b></span>
      <span class="chip">不正解 <b id="scoreNg">0</b></span>
      <span class="chip">残り <b id="remain">--:--</b></span>
    </div>

    <div class="control">
      <label>出題数：
        <select id="limitN">
          <option value="1">1</option>
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
          <option value="100" selected>100</option>
        </select> 問
      </label>
      <label>制限時間：
        <select id="limitMin">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="30">30</option>
          <option value="45">45</option>
          <option value="60">60</option>
          <option value="90">90</option>
          <option value="120" selected>120</option>
        </select> 分
      </label>
      <button id="start" class="primary">開始する</button>
      <button id="retry" style="display:none">もう一度</button>
    </div>

    <div id="stage" style="margin-top:16px">
      <div class="card muted">「開始する」を押すと出題を開始します。</div>
    </div>
  </div>

  <!-- ▼▼▼ ここに“元データ”：オブジェクトの並びだけを貼る ▼▼▼
       例： { ... }, { ... }, { ... }   ←角カッコは不要。下のスクリプトが自動で付けます。 -->
  <script id="raw-data" type="application/json">
    PASTE HERE
  </script>
  <!-- ▲▲▲ PASTE HERE にあなたの 1〜100問のオブジェクト列をコピペ ▲▲▲ -->

  <script>
    // --- iPhoneのダブルタップ拡大を抑制 ---
    let lastTouch=0;
    document.addEventListener('touchend',e=>{
      const now=Date.now();
      if(now-lastTouch<350){ e.preventDefault(); }
      lastTouch=now;
    },{passive:false});

    // --- データの読み込み（角カッコ自動付与 & エラー表示） ---
    function loadQuestions(){
      const node = document.getElementById('raw-data');
      if(!node) return [];
      const raw = node.textContent.trim();
      if(!raw){
        alert('問題データがありません。<script id="raw-data"> に配列（オブジェクト列）を貼ってください。');
        return [];
      }
      const jsonText = raw.startsWith('[') ? raw : `[${raw}\n]`;
      try{
        const arr = JSON.parse(jsonText);
        if(!Array.isArray(arr)) throw new Error('配列ではありません');
        return arr;
      }catch(err){
        console.error(err);
        alert('問題データ(JSON)の構文エラー：\n' + err.message + '\n\n※オブジェクトをカンマで区切った列にしてください。末尾カンマ不可。');
        return [];
      }
    }

    // --- 状態 ---
    const state = {
      all: [],
      order: [],
      idx: 0,
      limit: 100,
      ok: 0, ng: 0,
      endAt: 0,
      timerId: null
    };

    // --- UI ヘルパ ---
    const $ = sel => document.querySelector(sel);
    function fmtRemain(ms){
      if(ms<0) ms=0;
      const s = Math.floor(ms/1000);
      const m = Math.floor(s/60);
      const ss = (s%60).toString().padStart(2,'0');
      return `${m}:${ss}`;
    }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()* (i+1))|0; [a[i],a[j]]=[a[j],a[i]] } return a }

    // --- 出題描画 ---
    function render(){
      if(state.idx>=state.order.length){
        $('#stage').innerHTML = `
          <div class="card">
            <div class="qheader"><b>終了</b></div>
            <div class="qtext">おつかれさまでした。</div>
            <div class="foot">
              <span>正解 <b>${state.ok}</b> / 不正解 <b>${state.ng}</b> / 合計 <b>${state.order.length}</b></span>
              <span class="spacer"></span>
              <button id="retry2">もう一度</button>
            </div>
          </div>`;
        $('#retry').style.display='inline-block';
        $('#retry2').onclick=()=>location.reload();
        return;
      }

      const q = state.all[state.order[state.idx]];
      const labels = ['あ','い','う','え'];
      const choiceLines = q.choices.map((t,i)=> `${i+1}. ${t}`).join('\n');
      $('#stage').innerHTML = `
        <div class="card">
          <div class="qheader">
            <div>Q ${state.idx+1} / ${state.order.length}　<span class="muted">（元番号: ${q.number ?? '-' }）</span></div>
          </div>
          <div class="qtext">${(q.question||'').replace(/\n/g,'\n')}</div>
          <div class="choices"><div class="choice"><pre style="margin:0">${choiceLines}</pre></div></div>
          <div class="keys">
            ${labels.map((lab,idx)=>`<button class="keybtn" data-i="${idx}">${lab}</button>`).join('')}
          </div>
        </div>
      `;
      document.querySelectorAll('.keybtn').forEach(btn=>{
        btn.onclick=()=>{
          const i = +btn.dataset.i;
          const correct = (i===q.answer_index);
          btn.classList.add(correct?'ok':'ng');
          if(correct) state.ok++; else state.ng++;
          $('#scoreOk').textContent = state.ok;
          $('#scoreNg').textContent = state.ng;
          setTimeout(()=>{ state.idx++; render(); }, 220);
        };
      });
    }

    // --- タイマー ---
    function tick(){
      const remain = state.endAt - Date.now();
      $('#remain').textContent = fmtRemain(remain);
      if(remain<=0){
        clearInterval(state.timerId);
        state.idx = state.order.length;
        render();
      }
    }

    // --- 開始 ---
    $('#start').onclick=()=>{
      const all = loadQuestions();
      if(!all.length) return;

      state.limit = parseInt($('#limitN').value,10);
      const minutes = parseInt($('#limitMin').value,10);
      const pool = all.slice(0); // 元順でOK（要望）
      state.all = pool;
      state.order = Array.from({length: Math.min(state.limit, pool.length)}, (_,i)=>i);
      state.idx = 0; state.ok=0; state.ng=0;

      // UI
      $('#scoreOk').textContent='0';
      $('#scoreNg').textContent='0';
      $('#start').style.display='none';
      $('#retry').style.display='none';

      // タイマー開始（120分既定はselectの既定で実現）
      state.endAt = Date.now() + minutes*60*1000;
      if(state.timerId) clearInterval(state.timerId);
      state.timerId = setInterval(tick, 250);
      tick();

      render();
    };
    $('#retry').onclick=()=>location.reload();

    // 既定値反映（100問 / 120分）
    $('#limitN').value = '100';
    $('#limitMin').value = '120';
  </script>
</body>
</html>
